# --- Stage 1: Build Stage (Compiles the application) ---
# Using a specific, known-to-exist Maven/JDK 25 release candidate tag for the builder
FROM maven:4.0.0-rc-4-eclipse-temurin-25-noble AS builder
WORKDIR /app

# Copy the Maven build file and the source code
COPY pom.xml .
COPY src /app/src

# Compile the project and generate the executable JAR, skipping tests
RUN mvn clean package -DskipTests

# --- Stage 2: Runtime Stage (Runs the final application) ---
# Using a clean, small JRE 25 image (Guaranteed to exist)
FROM eclipse-temurin:25-jre-alpine
WORKDIR /app

# Copy the built JAR from the builder stage into the runtime image
# The asterisk (*) is used to match the full JAR name generated by Maven
COPY --from=builder /app/target/*.jar app.jar

# Set the command to run the application when the container starts
ENTRYPOINT ["java", "-jar", "/app.jar"]